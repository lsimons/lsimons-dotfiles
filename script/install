#!/usr/bin/env bash
#
# Legacy install script for lsimons-dotfiles (deprecated)
# Runs all install.sh scripts found in topic directories
# 
# NOTE: This is deprecated in favor of the Python-based install.py script.
# Use ./script/install.py instead for new installations.
#
# This script is safe to run multiple times (idempotent)

set -e

DOTFILES_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

info() {
  echo -e "${BLUE}[INFO]${NC} $1"
}

success() {
  echo -e "${GREEN}[SUCCESS]${NC} $1"
}

warn() {
  echo -e "${YELLOW}[WARN]${NC} $1"
}

error() {
  echo -e "${RED}[ERROR]${NC} $1"
}

# Run topic installers
main() {
  info "Starting topic installations..."
  info "Dotfiles root: $DOTFILES_ROOT"
  
  # Find all install.sh scripts
  local install_scripts=()
  while IFS= read -r -d '' script; do
    install_scripts+=("$script")
  done < <(find "$DOTFILES_ROOT" -name install.sh -type f -print0)
  
  if [ ${#install_scripts[@]} -eq 0 ]; then
    info "No install.sh scripts found"
    return 0
  fi
  
  # Run each install script
  for script in "${install_scripts[@]}"; do
    local topic="$(basename "$(dirname "$script")")"
    info "Running installer for: $topic"
    
    if bash "$script"; then
      success "Installed: $topic"
    else
      error "Failed to install: $topic"
      exit 1
    fi
  done
  
  success "All installations complete!"
}

main "$@"
